<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<title>æ—…éŠå°å·¥å…· ğŸŒŠ</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Kaisei+Opti:wght@400;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        ocean: { 50:'#e0f7ff', 100:'#b3edff', 200:'#7ddeff', 300:'#3dceff', 400:'#00bfea', 500:'#009ec2', 600:'#0080a0', 700:'#006280', 800:'#004560', 900:'#002840' },
        sand:  { 50:'#fffdf5', 100:'#fff8e1', 200:'#ffedb3', 300:'#ffdd80', 400:'#ffc94d', 500:'#f5a623', 600:'#d4881a', 700:'#a86812', 800:'#7c4a0b', 900:'#502e05' },
        ghibli:{ 50:'#f0fdf4', 100:'#dcfce7', 200:'#bbf7d0', 300:'#86efac', 400:'#4ade80', 500:'#22c55e', 600:'#16a34a', 700:'#15803d', 800:'#166534', 900:'#14532d' },
        totoro:'#7c9d7e',
      },
      fontFamily: {
        sans: ['"Noto Sans TC"','sans-serif'],
        display: ['"Kaisei Opti"','serif'],
      },
    }
  }
}
</script>
<style>
  /* ===== Base ===== */
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:#e8f8ff;font-family:'Noto Sans TC',sans-serif;color:#1a3040}
  #app{max-width:480px;margin:0 auto;min-height:100svh;background:#f0fbff;position:relative;padding-bottom:72px}

  /* ===== Header ===== */
  .app-header{background:linear-gradient(135deg,#0080a0 0%,#00bfea 60%,#7ddeff 100%);padding:14px 16px 10px;color:white;position:sticky;top:0;z-index:50;box-shadow:0 2px 12px rgba(0,128,160,.3)}
  .app-header h1{font-family:'Kaisei Opti',serif;font-size:20px;font-weight:700;margin:0;letter-spacing:1px}
  .app-header p{margin:0;font-size:12px;opacity:.85}

  /* ===== Bottom Nav ===== */
  .bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:white;border-top:1.5px solid #b3edff;display:flex;z-index:100;box-shadow:0 -4px 16px rgba(0,128,160,.12)}
  .bottom-nav button{flex:1;padding:8px 0 6px;background:none;border:none;cursor:pointer;font-size:10px;color:#006280;display:flex;flex-direction:column;align-items:center;gap:3px;transition:color .2s,background .2s}
  .bottom-nav button i{font-size:20px}
  .bottom-nav button.active{color:#00bfea;background:#e0f7ff}
  .bottom-nav button span{font-size:10px;font-weight:500}

  /* ===== Page ===== */
  .page{display:none;padding:14px 14px 8px;animation:fadeIn .22s ease}
  .page.active{display:block}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

  /* ===== Cards ===== */
  .card{background:white;border-radius:18px;box-shadow:0 4px 18px rgba(0,128,160,.10);padding:14px 16px;margin-bottom:14px}
  .card-ocean{border-top:4px solid #00bfea}
  .card-sand{border-top:4px solid #f5a623}
  .card-ghibli{border-top:4px solid #4ade80}

  /* ===== Timeline ===== */
  .timeline-day{margin-bottom:18px}
  .day-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
  .day-badge{background:linear-gradient(135deg,#00bfea,#009ec2);color:white;border-radius:12px;padding:4px 12px;font-size:13px;font-weight:700;font-family:'Kaisei Opti',serif;white-space:nowrap}
  .day-title{font-size:15px;font-weight:700;color:#004560}
  .timeline-items{border-left:3px solid #b3edff;padding-left:14px;margin-left:6px}
  .timeline-item{position:relative;padding:8px 0 8px 0;margin-bottom:2px}
  .timeline-item::before{content:'';position:absolute;left:-19px;top:14px;width:11px;height:11px;background:#00bfea;border-radius:50%;border:2px solid white;box-shadow:0 0 0 2px #7ddeff}
  .timeline-item.flight::before{background:#f5a623}
  .timeline-item.hotel::before{background:#4ade80}
  .timeline-item.important::before{background:#ef4444;box-shadow:0 0 0 3px #fca5a5}
  .item-name{font-size:14px;font-weight:600;color:#003850}
  .item-note{font-size:12px;color:#5a7a8a;margin-top:2px}
  .item-tags{display:flex;flex-wrap:wrap;gap:5px;margin-top:5px}
  .tag{font-size:11px;padding:2px 8px;border-radius:999px;font-weight:500}
  .tag-blue{background:#e0f7ff;color:#0080a0}
  .tag-green{background:#dcfce7;color:#15803d}
  .tag-orange{background:#fff7ed;color:#c2410c}
  .tag-red{background:#fee2e2;color:#b91c1c}
  .map-btn{display:inline-flex;align-items:center;gap:4px;font-size:11px;padding:3px 9px;border-radius:999px;background:#e0f7ff;color:#0080a0;border:none;cursor:pointer;margin-top:4px;text-decoration:none;font-weight:500}
  .map-btn:hover{background:#00bfea;color:white}
  .important-badge{background:#ef4444;color:white;font-size:11px;padding:2px 8px;border-radius:999px;font-weight:700}

  /* ===== Hotel Card ===== */
  .hotel-card{background:linear-gradient(135deg,#e0f7ff,#f0fff4);border-radius:14px;padding:12px 14px;margin-top:6px;border:1.5px solid #b3edff}

  /* ===== Guide ===== */
  .guide-section{margin-bottom:18px}
  .guide-section h3{font-family:'Kaisei Opti',serif;font-size:17px;color:#004560;border-left:4px solid #00bfea;padding-left:10px;margin-bottom:8px}
  .guide-section p{font-size:13.5px;line-height:1.8;color:#2a4050;margin:0 0 6px}
  .guide-section .tips{background:#fff8e1;border-radius:10px;padding:10px 12px;font-size:12.5px;color:#7c4a0b;margin-top:6px}
  .guide-section .tips i{color:#f5a623;margin-right:5px}
  .guide-map{width:100%;height:220px;border-radius:14px;border:2px solid #b3edff;margin-top:8px}

  /* ===== Wallet ===== */
  .rate-display{display:flex;justify-content:space-between;align-items:center;background:#e0f7ff;border-radius:12px;padding:10px 14px;margin-bottom:10px}
  .calc-display{background:#001e2e;color:#7ddeff;border-radius:12px;padding:12px;font-size:22px;font-family:monospace;text-align:right;margin-bottom:10px;min-height:52px;word-break:break-all}
  .calc-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:10px}
  .calc-btn{background:white;border:1.5px solid #b3edff;border-radius:10px;padding:13px 0;font-size:17px;font-weight:600;cursor:pointer;color:#003850;transition:all .15s}
  .calc-btn:hover{background:#e0f7ff;border-color:#00bfea}
  .calc-btn.op{background:#e0f7ff;color:#0080a0}
  .calc-btn.eq{background:linear-gradient(135deg,#00bfea,#009ec2);color:white;border-color:#00bfea}
  .calc-btn.clr{background:#fee2e2;color:#b91c1c;border-color:#fca5a5}
  .converted{text-align:center;font-size:13px;color:#5a7a8a;margin-bottom:14px}
  .expense-item-row{display:flex;align-items:center;gap:8px;margin-bottom:10px}
  .expense-item-row input{flex:1;border:1.5px solid #b3edff;border-radius:10px;padding:9px 12px;font-size:14px;outline:none;font-family:'Noto Sans TC',sans-serif}
  .expense-item-row input:focus{border-color:#00bfea}
  .expense-record{display:flex;align-items:center;gap:10px;background:#f8fcff;border-radius:12px;padding:10px 12px;margin-bottom:8px;border:1px solid #e0f7ff}
  .expense-thumb{width:48px;height:48px;border-radius:8px;object-fit:cover;flex-shrink:0}
  .expense-thumb-placeholder{width:48px;height:48px;border-radius:8px;background:#e0f7ff;display:flex;align-items:center;justify-content:center;flex-shrink:0}
  .expense-info{flex:1;min-width:0}
  .expense-name{font-size:13px;font-weight:600;color:#003850;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .expense-amount{font-size:12px;color:#0080a0}
  .expense-total-bar{background:linear-gradient(135deg,#003850,#006280);color:white;border-radius:14px;padding:12px 16px;margin-top:8px;display:flex;justify-content:space-between;align-items:center}

  /* ===== Lists ===== */
  .checklist-item{display:flex;align-items:center;gap:10px;padding:9px 4px;border-bottom:1px solid #e8f8ff;cursor:pointer}
  .checklist-item input[type=checkbox]{width:18px;height:18px;accent-color:#00bfea;cursor:pointer;flex-shrink:0}
  .checklist-item label{font-size:14px;color:#1a3040;cursor:pointer}
  .checklist-item.checked label{text-decoration:line-through;color:#a0b8c8}
  .checklist-section-title{font-size:13px;font-weight:700;color:#0080a0;padding:8px 0 4px;border-bottom:2px solid #e0f7ff;margin-bottom:4px;display:flex;align-items:center;gap:6px}
  .memo-item{display:flex;align-items:flex-start;gap:8px;background:#f8fcff;border-radius:10px;padding:10px 12px;margin-bottom:7px;border:1px solid #e0f7ff}
  .memo-item p{margin:0;font-size:13.5px;line-height:1.7;word-break:break-all}
  .memo-item a{color:#0080a0;text-decoration:underline}

  /* ===== Info ===== */
  .info-link{display:flex;align-items:center;gap:12px;background:white;border-radius:14px;padding:13px 15px;margin-bottom:10px;box-shadow:0 2px 10px rgba(0,128,160,.08);text-decoration:none;color:#1a3040;transition:background .2s}
  .info-link:hover{background:#e0f7ff}
  .info-link .icon-circle{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:18px}
  .info-section-title{font-size:14px;font-weight:700;color:#0080a0;margin:14px 0 8px;display:flex;align-items:center;gap:6px}
  .emergency-card{background:linear-gradient(135deg,#fff1f2,#fff8f0);border:1.5px solid #fca5a5;border-radius:14px;padding:12px 14px;margin-bottom:10px}
  .emergency-number{font-size:22px;font-weight:700;color:#b91c1c;font-family:'Kaisei Opti',serif}
  .notice-item{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid #e8f8ff;font-size:13px;line-height:1.6}
  .notice-item i{color:#f5a623;margin-top:2px;flex-shrink:0}

  /* ===== Dashboard ===== */
  .dash-stat{background:linear-gradient(135deg,#e0f7ff,#f0fff4);border-radius:16px;padding:14px 16px;text-align:center}
  .dash-stat-value{font-size:26px;font-weight:700;color:#004560;font-family:'Kaisei Opti',serif}
  .dash-stat-label{font-size:12px;color:#5a7a8a;margin-top:2px}
  .progress-bar{height:8px;border-radius:999px;background:#e0f7ff;overflow:hidden;margin-top:6px}
  .progress-fill{height:100%;background:linear-gradient(90deg,#00bfea,#009ec2);border-radius:999px;transition:width .5s ease}

  /* ===== Totoro Deco ===== */
  .totoro-deco{font-size:36px;text-align:center;margin:8px 0 4px;animation:float 3s ease-in-out infinite}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

  /* ===== Rent Car ===== */
  .rent-card{background:linear-gradient(135deg,#fffdf5,#fff8e1);border:1.5px solid #ffc94d;border-radius:16px;padding:14px 16px;margin-bottom:12px}
  .rent-card h4{font-family:'Kaisei Opti',serif;color:#7c4a0b;font-size:15px;margin:0 0 8px}

  /* ===== Tabs (å†…éƒ¨å­é ) ===== */
  .inner-tabs{display:flex;gap:6px;margin-bottom:12px;overflow-x:auto;padding-bottom:2px}
  .inner-tab{flex-shrink:0;padding:6px 14px;border-radius:999px;font-size:13px;font-weight:600;border:1.5px solid #b3edff;background:white;color:#0080a0;cursor:pointer;transition:all .2s}
  .inner-tab.active{background:#00bfea;color:white;border-color:#00bfea}

  /* ===== Btn ===== */
  .btn-primary{background:linear-gradient(135deg,#00bfea,#009ec2);color:white;border:none;border-radius:12px;padding:10px 20px;font-size:14px;font-weight:700;cursor:pointer;font-family:'Noto Sans TC',sans-serif;transition:opacity .2s}
  .btn-primary:hover{opacity:.88}
  .btn-danger{background:#fee2e2;color:#b91c1c;border:1.5px solid #fca5a5;border-radius:10px;padding:6px 12px;font-size:12px;cursor:pointer;font-family:'Noto Sans TC',sans-serif}
  .btn-ghost{background:white;border:1.5px solid #b3edff;color:#0080a0;border-radius:10px;padding:8px 14px;font-size:13px;cursor:pointer;font-family:'Noto Sans TC',sans-serif;transition:background .2s}
  .btn-ghost:hover{background:#e0f7ff}

  /* ===== Rate Editor ===== */
  .rate-edit-row{display:flex;align-items:center;gap:8px;margin-top:8px}
  .rate-edit-row input{width:80px;border:1.5px solid #b3edff;border-radius:8px;padding:6px 8px;font-size:14px;text-align:center;outline:none}
  .rate-edit-row input:focus{border-color:#00bfea}

  /* ===== Wave deco ===== */
  .wave-divider{width:100%;overflow:hidden;line-height:0;margin-bottom:-4px}
  .wave-divider svg{display:block;width:100%}

  /* ===== Photo upload ===== */
  .photo-upload-btn{display:flex;align-items:center;gap:6px;background:#e0f7ff;border:1.5px dashed #00bfea;border-radius:10px;padding:9px 14px;color:#0080a0;font-size:13px;cursor:pointer;font-weight:600;font-family:'Noto Sans TC',sans-serif;width:100%;justify-content:center;margin-bottom:10px;transition:background .2s}
  .photo-upload-btn:hover{background:#b3edff}
  canvas{display:none}
</style>
</head>
<body>
<div id="app">

  <!-- ===== HEADER ===== -->
  <header class="app-header">
    <div class="wave-divider" style="position:absolute;bottom:0;left:0;right:0;pointer-events:none">
      <svg viewBox="0 0 480 12" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" height="12">
        <path d="M0,6 C80,12 160,0 240,6 C320,12 400,0 480,6 L480,12 L0,12 Z" fill="rgba(255,255,255,0.3)"/>
      </svg>
    </div>
    <div style="display:flex;align-items:center;gap:10px">
      <span style="font-size:26px">ğŸŒŠ</span>
      <div>
        <h1>æ—…éŠå°å·¥å…·</h1>
        <p>IT728 05/28 16:15 âœˆ IT729 06/01 10:30</p>
      </div>
    </div>
  </header>

  <!-- ===== PAGES ===== -->

  <!-- PLAN -->
  <section id="page-plan" class="page active">
    <div class="totoro-deco">ğŸ±</div>

    <!-- D1 -->
    <div class="timeline-day">
      <div class="day-header">
        <div class="day-badge">5/28 å››</div>
        <div class="day-title">æŠµé”ãƒ»åœ‹éš›é€š</div>
      </div>
      <div class="timeline-items">
        <div class="timeline-item flight">
          <div class="item-name">âœˆ IT728 å‡ºç™¼</div>
          <div class="item-note">16:15 èµ·é£› â†’ 18:40 æŠµé”é‚£éœ¸</div>
          <div class="item-tags">
            <span class="tag tag-orange">è™èˆª</span>
            <span class="important-badge">é›†åˆé‡è¦</span>
          </div>
        </div>
        <div class="timeline-item">
          <div class="item-name">ğŸ› åœ‹éš›é€š</div>
          <div class="item-note">é‚£éœ¸æœ€ç†±é¬§çš„è³¼ç‰©å•†åº—è¡—ï¼Œç´„ 1.6 å…¬é‡Œ</div>
          <div class="item-tags"><span class="tag tag-blue">è³¼ç‰©</span><span class="tag tag-green">æ•£æ­¥</span></div>
          <a class="map-btn" href="https://maps.google.com/?q=å›½éš›é€šã‚Š+é‚£è¦‡+æ²–ç¸„" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item hotel">
          <div class="item-name">ğŸ¨ é‚£éœ¸ä¼‘ä¼Šç‰¹æ¸¡å‡é£¯åº—</div>
          <div class="item-note">ãƒ’ãƒ¥ãƒ¼ã‚¤ãƒƒãƒˆãƒªã‚¾ãƒ¼ãƒˆé‚£è¦‡ Â· +81989438325</div>
          <a class="map-btn" href="https://maps.google.com/?q=ãƒ’ãƒ¥ãƒ¼ã‚¤ãƒƒãƒˆãƒªã‚¾ãƒ¼ãƒˆé‚£è¦‡" target="_blank"><i class="fa fa-map-marker-alt"></i>é£¯åº—ä½ç½®</a>
        </div>
      </div>
    </div>

    <!-- D2 -->
    <div class="timeline-day">
      <div class="day-header">
        <div class="day-badge">5/29 äº”</div>
        <div class="day-title">æµ·å²¸ç·šãƒ»è£½é¹½å·¥å» </div>
      </div>
      <div class="timeline-items">
        <div class="timeline-item important">
          <div class="item-name">ğŸš— å–è»Š</div>
          <div class="item-note">æ²–ç¸„è¡Œè„šãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ãƒ»é ç´„å°ç¥¿è»Šç«™æ¥é€</div>
          <div class="item-tags"><span class="tag tag-red">éœ€å¸¶è­·ç…§+é§•ç…§+æ—¥æ–‡è­¯æœ¬</span></div>
        </div>
        <div class="timeline-item">
          <div class="item-name">â›© æ³¢ä¸Šå®®</div>
          <div class="item-note">æ²–ç¹©æœ€å¤è€çš„ç¥ç¤¾ï¼Œä¿¯ç°æ³¢ä¹‹ä¸Šæµ·ç˜</div>
          <a class="map-btn" href="https://maps.google.com/?q=æ³¢ä¸Šå®®+é‚£è¦‡" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item">
          <div class="item-name">ğŸŒ‰ æµ·ä¸­é“è·¯</div>
          <div class="item-note">å…¨é•·ç´„ 4.7 å…¬é‡Œçš„æµ·ä¸Šå…¬è·¯ï¼Œæ™¯è‰²å£¯é—Š</div>
          <a class="map-btn" href="https://maps.google.com/?q=æµ·ä¸­é“è·¯+æ²–ç¸„" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item">
          <div class="item-name">ğŸŒŠ å¤§åŸ”æµ·å²¸</div>
          <div class="item-note">æ¸…æ¾ˆæµ·æ°´ï¼Œé©åˆè¸æµªæ‹ç…§</div>
          <a class="map-btn" href="https://maps.google.com/?q=å¤§æ³Šæµ·å²¸+æ²–ç¸„" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item">
          <div class="item-name">ğŸ§‚ å‘½å¾¡åº­ è£½é¹½å·¥å» </div>
          <div class="item-note">ã¬ã¡ã¾ãƒ¼ã™è¦³å…‰è£½å¡©ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ï¼Œä¸–ç•Œæœ€é«˜ç¤¦ç‰©è³ªå«é‡æµ·é¹½</div>
          <a class="map-btn" href="https://maps.google.com/?q=ã¬ã¡ã¾ãƒ¼ã™è¦³å…‰è£½å¡©ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item hotel">
          <div class="item-name">ğŸ  Airbnb è®€è°·å…¬å¯“</div>
          <div class="item-note">ä»Šæ˜å…©æ™šä½è®€è°·</div>
        </div>
      </div>
    </div>

    <!-- D3 -->
    <div class="timeline-day">
      <div class="day-header">
        <div class="day-badge">5/30 å…­</div>
        <div class="day-title">æ´çªŸãƒ»æµ·é‚Šãƒ»åŸè·¡</div>
      </div>
      <div class="timeline-items">
        <div class="timeline-item">
          <div class="item-name">ğŸ¤¿ é’ä¹‹æ´çªŸ</div>
          <div class="item-note">æ©ç´æ‘è‘—åæµ®æ½›æ™¯é»ï¼Œå…‰ç·šæŠ˜å°„æˆæ¹›è—</div>
          <a class="map-btn" href="https://maps.google.com/?q=é’ã®æ´çªŸ+æ©ç´æ‘+æ²–ç¸„" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item">
          <div class="item-name">ğŸ„ æµ·é‚Šæ´»å‹•</div>
          <div class="item-note">è‡ªç”±å®‰æ’æµ·ä¸Šæ´»å‹•ï¼Œäº«å—é™½å…‰</div>
        </div>
        <div class="timeline-item">
          <div class="item-name">ğŸ¯ æ®˜æ³¢å²¬ç‡ˆå¡”</div>
          <div class="item-note">è®€è°·æ¨™èªŒï¼Œå²¬è§’ç™½è‰²ç‡ˆå¡”çµ•æ™¯</div>
          <a class="map-btn" href="https://maps.google.com/?q=æ®‹æ³¢å²¬ç¯å°+èª­è°·" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item">
          <div class="item-name">ğŸ­ ç‰çƒæ‘</div>
          <div class="item-note">é«”é©—å‚³çµ±ç‰çƒæ–‡åŒ–ãƒ»ç‰çƒèˆè¹ˆãƒ»ç¹”å¸ƒ</div>
          <a class="map-btn" href="https://maps.google.com/?q=ç‰çƒæ‘+èª­è°·" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item">
          <div class="item-name">ğŸ° åº§å–œå‘³åŸ</div>
          <div class="item-note">ä¸–ç•Œéºç”¢ç‰çƒåŸè·¡ä¹‹ä¸€ï¼ŒçŸ³ç‰†å·¥æ³•ç²¾æ¹›</div>
          <a class="map-btn" href="https://maps.google.com/?q=åº§å–œå‘³åŸè·¡+èª­è°·" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item hotel">
          <div class="item-name">ğŸ  Airbnb è®€è°·å…¬å¯“</div>
        </div>
      </div>
    </div>

    <!-- D4 -->
    <div class="timeline-day">
      <div class="day-header">
        <div class="day-badge">5/31 æ—¥</div>
        <div class="day-title">ç¾åœ‹æ‘ãƒ»è¿”é‚£éœ¸</div>
      </div>
      <div class="timeline-items">
        <div class="timeline-item">
          <div class="item-name">ğŸŒ† ç¾åœ‹æ‘</div>
          <div class="item-note">åŒ—è°·ç”ºç¾å¼è³¼ç‰©å¨›æ¨‚è¡—å€ï¼Œé©åˆé€›è¡—æ‹ç…§</div>
          <a class="map-btn" href="https://maps.google.com/?q=ç¾æµœã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ“ãƒ¬ãƒƒã‚¸+åŒ—è°·" target="_blank"><i class="fa fa-map-marker-alt"></i>Google Maps</a>
        </div>
        <div class="timeline-item">
          <div class="item-name">ğŸŒ® åˆé¤ï¼šTaco Rice</div>
          <div class="item-note">æ²–ç¹©ç‰¹è‰²æ–™ç†ï¼Œå¢¨è¥¿å“¥å¡”å¯é£¯èåˆç‰ˆ</div>
          <a class="map-btn" href="https://maps.google.com/?q=ã‚¿ã‚³ãƒ©ã‚¤ã‚¹+ç¾æµœ+æ²–ç¸„" target="_blank"><i class="fa fa-map-marker-alt"></i>é£Ÿè¨˜æœå°‹</a>
        </div>
        <div class="timeline-item important">
          <div class="item-name">ğŸš— é‚„è»Š</div>
          <div class="item-note">é‚„è»Šå‰åŠ æ»¿æ²¹ï¼Œç•™ä¸‹åŠ æ²¹æ”¶æ“š</div>
          <div class="item-tags"><span class="tag tag-red">åŠ æ²¹æ”¶æ“šè¦ç•™</span></div>
        </div>
        <div class="timeline-item hotel">
          <div class="item-name">ğŸ¨ é‚£éœ¸ä¼‘ä¼Šç‰¹æ¸¡å‡é£¯åº—</div>
          <div class="item-note">ãƒ’ãƒ¥ãƒ¼ã‚¤ãƒƒãƒˆãƒªã‚¾ãƒ¼ãƒˆé‚£è¦‡</div>
        </div>
      </div>
    </div>

    <!-- D5 -->
    <div class="timeline-day">
      <div class="day-header">
        <div class="day-badge">6/1 ä¸€</div>
        <div class="day-title">è¿”ç¨‹æ—¥</div>
      </div>
      <div class="timeline-items">
        <div class="timeline-item flight important">
          <div class="item-name">âœˆ IT729 è¿”å°</div>
          <div class="item-note">10:30 é‚£éœ¸å‡ºç™¼ â†’ 11:20 æŠµé”</div>
          <div class="item-tags">
            <span class="tag tag-orange">è™èˆª</span>
            <span class="important-badge">ææ—©åˆ°æ©Ÿå ´</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ç§Ÿè»Šè³‡è¨Š -->
    <div class="rent-card">
      <h4><i class="fa fa-car mr-1"></i> ç§Ÿè»Šè³‡è¨Š</h4>
      <div style="font-size:14px;font-weight:600;color:#7c4a0b;margin-bottom:4px">æ²–ç¸„è¡Œè„šãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼</div>
      <div style="font-size:13px;color:#5a7a8a;margin-bottom:8px">é ç´„å°ç¥¿è»Šç«™æ¥é€</div>
      <div style="font-size:13px;margin-bottom:4px"><b>éœ€å¸¶ï¼š</b>è­·ç…§ãƒ»å°ç£é§•ç…§ãƒ»æ—¥æ–‡è­¯æœ¬</div>
      <div style="font-size:13px"><b>æ³¨æ„ï¼š</b>é‚„è»Šå‰æ±½æ²¹åŠ æ»¿ï¼ŒåŠ æ²¹æ”¶æ“šè¦ç•™</div>
    </div>

    <!-- ä½å®¿é€ŸæŸ¥ -->
    <div class="card card-ghibli">
      <div style="font-size:14px;font-weight:700;color:#166534;margin-bottom:10px"><i class="fa fa-bed" style="margin-right:6px"></i>ä½å®¿é€ŸæŸ¥</div>
      <div class="hotel-card" style="margin-bottom:8px">
        <div style="font-size:13px;font-weight:700">D1 &amp; D4ï½œé‚£éœ¸ä¼‘ä¼Šç‰¹æ¸¡å‡é£¯åº—</div>
        <div style="font-size:12px;color:#5a7a8a;margin-top:3px">ã€’902-0067 Okinawa, Naha, Asato, 2 Chome-5-16</div>
        <div style="font-size:12px;color:#5a7a8a">ãƒ’ãƒ¥ãƒ¼ã‚¤ãƒƒãƒˆãƒªã‚¾ãƒ¼ãƒˆé‚£è¦‡</div>
        <div style="font-size:13px;color:#0080a0;font-weight:600;margin-top:4px"><i class="fa fa-phone" style="margin-right:4px"></i>+81989438325</div>
        <a class="map-btn" style="margin-top:6px" href="https://maps.google.com/?q=ãƒ’ãƒ¥ãƒ¼ã‚¤ãƒƒãƒˆãƒªã‚¾ãƒ¼ãƒˆé‚£è¦‡" target="_blank"><i class="fa fa-map-marker-alt"></i>é£¯åº—ä½ç½®</a>
      </div>
      <div class="hotel-card">
        <div style="font-size:13px;font-weight:700">D2 &amp; D3ï½œAirbnb è®€è°·å…¬å¯“</div>
        <div style="font-size:12px;color:#5a7a8a;margin-top:3px">è®€è°·æ‘ãƒ»ä¾ Airbnb ç¢ºèªè©³ç´°åœ°å€</div>
      </div>
    </div>
  </section>

  <!-- GUIDE -->
  <section id="page-guide" class="page">
    <div class="totoro-deco">ğŸŒ¿</div>

    <div class="guide-section card card-ocean">
      <h3>ğŸŒŠ é’ä¹‹æ´çªŸ</h3>
      <p>é’ä¹‹æ´çªŸä½æ–¼æ²–ç¹©æœ¬å³¶ä¸­éƒ¨çš„æ©ç´æ‘çœŸæ¦®ç”°å²¬ï¼Œæ˜¯æ—¥æœ¬æ•¸ä¸€æ•¸äºŒçš„æµ·åº•å¥‡æ™¯ã€‚æ´çªŸå…§é™½å…‰é€éæµ·é¢æŠ˜å°„ï¼Œå°‡æ•´å€‹æ´çªŸæŸ“æˆå¤¢å¹»çš„æ¹›è—è‰²ï¼Œå½·å½¿ç½®èº«æ–¼å®®å´é§¿å‹•ç•«ä¸­çš„ç¥ç§˜ä¸–ç•Œã€‚</p>
      <div class="tips"><i class="fa fa-lightbulb"></i><b>å°çŸ¥è­˜ï¼š</b>æ´çªŸå¯¦éš›ä¸Šæ˜¯å¤æ™‚æµ·è•å½¢æˆçš„æµ·åº•éš§é“ï¼Œæœ€ä½³æ½›å…¥æ™‚é–“ç‚ºæ™´å¤©ä¸Šåˆ 10-12 é»ï¼Œå…‰ç·šæŠ˜å°„æ•ˆæœæœ€ä½³ã€‚è¨˜å¾—å¸¶é˜²æ°´è¢‹ä¿è­·æ‰‹æ©Ÿï¼</div>
      <iframe class="guide-map" src="https://www.openstreetmap.org/export/embed.html?bbox=127.74,26.38,127.76,26.40&layer=mapnik&marker=26.394,127.752" title="é’ä¹‹æ´çªŸåœ°åœ–"></iframe>
    </div>

    <div class="guide-section card card-ocean">
      <h3>ğŸ¯ åº§å–œå‘³åŸ</h3>
      <p>åº§å–œå‘³åŸæ˜¯æ²–ç¹©ä¸–ç•Œéºç”¢ç‰çƒç‹åœ‹åŸè·¡çš„ä¸€å“¡ï¼Œå»ºæ–¼ 15 ä¸–ç´€åˆï¼Œä»¥ç²¾å¯†çš„ã€Œå¸ƒç©ã¿ã€çŸ³ç‰†å·¥æ³•èåï¼Œæ‹±é–€é€ å‹åœ¨ç‰çƒåŸè·¡ä¸­çµ•ç„¡åƒ…æœ‰ã€‚ç™»ä¸ŠåŸç‰†å¯ä¿¯ç°è®€è°·å…¨æ™¯ã€‚</p>
      <div class="tips"><i class="fa fa-lightbulb"></i><b>å°çŸ¥è­˜ï¼š</b>åº§å–œå‘³åŸæ›¾åœ¨äºŒæˆ°ä¸­è¢«ç¾è»ç”¨ä½œé›·é”åŸºåœ°ï¼Œæˆ°å¾Œæ‰é€æ­¥ä¿®å¾©ã€‚åŸç‰†çš„å¼“å½¢æ‹±é–€æ˜¯ç‰çƒæœ€å¤è€çš„æ‹±é–€å½¢å¼ã€‚</div>
      <iframe class="guide-map" src="https://www.openstreetmap.org/export/embed.html?bbox=127.73,26.36,127.75,26.38&layer=mapnik&marker=26.375,127.742" title="åº§å–œå‘³åŸåœ°åœ–"></iframe>
    </div>

    <div class="guide-section card card-ocean">
      <h3>â›© æ³¢ä¸Šå®®</h3>
      <p>æ³¢ä¸Šå®®æ˜¯æ²–ç¹©ç¸£å…§æœ€å¤è€ã€æœ€é‡è¦çš„ç¥ç¤¾ï¼Œä¾›å¥‰æ²–ç¹©å›ºæœ‰çš„ã€Œãƒ‹ãƒ©ã‚¤ã‚«ãƒŠã‚¤ã€ç¥ç¥‡ä¿¡ä»°ï¼Œé¢æµ·è€Œå»ºï¼ŒèƒŒå¾Œå³æ˜¯æ³¢ä¹‹ä¸Šæµ·ç˜ï¼Œç¥ç¤¾èˆ‡å¤§æµ·é€£æˆå£¯éº—æ™¯è§€ã€‚</p>
      <div class="tips"><i class="fa fa-lightbulb"></i><b>å°çŸ¥è­˜ï¼š</b>ãƒ‹ãƒ©ã‚¤ã‚«ãƒŠã‚¤ï¼ˆNirai Kanaiï¼‰æ˜¯ç‰çƒå¤è€ç¥è©±ä¸­çš„æµ·åº•æ¨‚åœ’ï¼Œè¢«è¦–ç‚ºå¹¸ç¦èˆ‡è±é¥’çš„ä¾†æºï¼Œé¡ä¼¼æ—¥æœ¬æœ¬åœŸçš„ã€Œå¸¸ä¸–ä¹‹åœ‹ã€ã€‚</div>
      <iframe class="guide-map" src="https://www.openstreetmap.org/export/embed.html?bbox=127.67,26.21,127.69,26.23&layer=mapnik&marker=26.221,127.681" title="æ³¢ä¸Šå®®åœ°åœ–"></iframe>
    </div>

    <div class="guide-section card card-sand">
      <h3>ğŸ§‚ å‘½å¾¡åº­ è£½é¹½å·¥å» </h3>
      <p>ã€Œã¬ã¡ã¾ãƒ¼ã™ã€åœ¨æ²–ç¹©æ–¹è¨€ä¸­æ„æŒ‡ã€Œç”Ÿå‘½ä¹‹é¹½ã€ï¼Œé€™è£¡ç”Ÿç”¢çš„æµ·é¹½å«æœ‰é«˜é” 21 ç¨®ç¤¦ç‰©è³ªï¼Œè¢«é‡‘æ°ä¸–ç•Œç´€éŒ„èªå®šç‚ºä¸–ç•Œä¸Šç¤¦ç‰©è³ªç¨®é¡æœ€å¤šçš„é£Ÿé¹½ï¼Œæ¡ç”¨ç¨ç‰¹çš„ã€Œå¸¸æº«ç¬é–“ç©ºä¸­è£½é¹½æ³•ã€ã€‚</p>
      <div class="tips"><i class="fa fa-lightbulb"></i><b>ä¼´æ‰‹ç¦®æ¨è–¦ï¼š</b>å‘½å¾¡åº­é¹½å¯åšç‚ºç‰¹è‰²ä¼´æ‰‹ç¦®ï¼Œæœ‰å…¥æµ´é¹½ã€æ–™ç†é¹½ç­‰å¤šç¨®é¸æ“‡ã€‚å·¥å» æä¾›å…è²»åƒè§€å°è¦½ã€‚</div>
    </div>

    <div class="guide-section card card-sand">
      <h3>ğŸŒ‰ æµ·ä¸­é“è·¯</h3>
      <p>æµ·ä¸­é“è·¯æ˜¯é€£æ¥æ²–ç¹©æœ¬å³¶èˆ‡å‹é€£åŠå³¶çš„æµ·ä¸Šå…¬è·¯ï¼Œå…¨é•· 4.7 å…¬é‡Œï¼Œè¡Œé§›å…¶ä¸Šï¼Œæ¹›è—å¤§æµ·ç’°ç¹å››å‘¨ï¼Œæ˜¯æ²–ç¹©æœ€å…·ä»£è¡¨æ€§çš„å…œé¢¨è·¯ç·šä¹‹ä¸€ã€‚å…©å´å¯è¦‹æ½®é–“å¸¶ç”Ÿæ…‹ã€‚</p>
      <div class="tips"><i class="fa fa-lightbulb"></i><b>æ‹ç…§æ™‚æ©Ÿï¼š</b>é€€æ½®æ™‚å…©å´å¯è¦‹å¤§ç‰‡æ½®é–“å¸¶ï¼Œæ¼²æ½®æ™‚å‰‡æµ·é¢å¹¾ä¹èˆ‡è·¯é¢é½Šå¹³ï¼Œæ™¯è‰²å„æœ‰ç‰¹è‰²ã€‚ä¸‹åˆå…‰ç·šå¾è¥¿é‚Šç…§å°„ï¼Œæ‹ç…§é€†å…‰æ•ˆæœæ¥µç¾ã€‚</div>
    </div>

    <div class="guide-section card card-ghibli">
      <h3>ğŸ­ ç‰çƒæ‘</h3>
      <p>ç‰çƒæ‘æ˜¯ä¸€åº§é–‹æ”¾å¼åšç‰©é¤¨ï¼Œé‡ç¾å‚³çµ±ç‰çƒæ°‘å®¶èšè½ï¼Œæä¾›ç¹”å¸ƒé«”é©—ã€ç‰çƒèˆè¹ˆå…¬æ¼”ã€é»‘ç³–è£½ä½œç­‰æ–‡åŒ–æ´»å‹•ï¼Œä¿å­˜å¤æ°‘å®¶è¶…é 10 æ£Ÿï¼Œæ˜¯äº†è§£ç‰çƒå‚³çµ±ç”Ÿæ´»çš„å¥½åœ°æ–¹ã€‚</p>
      <div class="tips"><i class="fa fa-lightbulb"></i><b>æ¨è–¦é«”é©—ï¼š</b>ç´…å‹æŸ“å¸ƒé«”é©—ã€ä¸‰ç·šç´é«”é©—éƒ½è¶…æœ‰è¶£ï¼Œå¯ä»¥å¸¶èµ°è¦ªæ‰‹è£½ä½œçš„ç´€å¿µå“ã€‚èˆè¹ˆå…¬æ¼”æ¯æ—¥æ•¸å ´ï¼Œå…è²»è§€è³ã€‚</div>
    </div>

    <div class="guide-section card card-ghibli">
      <h3>ğŸŒ† ç¾åœ‹æ‘ï¼ˆã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ“ãƒ¬ãƒƒã‚¸ï¼‰</h3>
      <p>ç¾åœ‹æ‘ä½æ–¼åŒ—è°·ç”ºï¼Œæ˜¯äºŒæˆ°å¾Œç¾è»è¿”é‚„åœŸåœ°å†é–‹ç™¼çš„å•†æ¥­å¨›æ¨‚å€ï¼Œå……æ»¿æ¿ƒåšç¾å¼é¢¨æƒ…ï¼Œæœ‰å¤§å‹æ‘©å¤©è¼ªã€æµ·æ™¯è³¼ç‰©ä¸­å¿ƒã€å„å¼é¤å»³ï¼Œå‚æ™šå¤•é™½æ™¯è‰²æ˜¯æ²–ç¹©å¿…æ‹åæ™¯ã€‚</p>
      <div class="tips"><i class="fa fa-lightbulb"></i><b>Taco Riceï¼š</b>æ²–ç¹©çš„éˆé­‚æ–™ç†ï¼Œå°‡å¢¨è¥¿å“¥å¡”å¯é¤¡æ–™ï¼ˆç¢è‚‰ã€èµ·å¸ã€èµè‹£ã€ç•ªèŒ„ï¼‰é‹ªåœ¨ç™½é£¯ä¸Šï¼Œæ˜¯ç”±ç¾è»åŸºåœ°æ—çš„å¢¨è¥¿å“¥æ–™ç†æ¼”åŒ–è€Œä¾†çš„ç¨ç‰¹æ²–ç¹©æ–™ç†ã€‚</div>
    </div>
  </section>

  <!-- WALLET -->
  <section id="page-wallet" class="page">
    <div class="totoro-deco">ğŸ’°</div>

    <!-- åŒ¯ç‡æ›ç®—è¨ˆç®—æ©Ÿ -->
    <div class="card card-ocean" style="margin-bottom:14px">
      <div style="font-size:14px;font-weight:700;color:#004560;margin-bottom:8px"><i class="fa fa-calculator" style="margin-right:6px"></i>åŒ¯ç‡æ›ç®—è¨ˆç®—æ©Ÿ</div>
      <div class="rate-display">
        <span style="font-size:13px;color:#0080a0">1 JPY =</span>
        <div class="rate-edit-row" style="margin:0">
          <input type="number" id="rate-input" step="0.001" min="0.001" style="width:72px"/>
          <span style="font-size:13px;color:#0080a0">TWD</span>
          <button class="btn-ghost" style="padding:5px 10px;font-size:12px" onclick="saveRate()">å„²å­˜</button>
        </div>
      </div>
      <div class="calc-display" id="calc-display">0</div>
      <div class="converted" id="calc-converted">â‰ˆ 0 TWD</div>
      <div class="calc-grid">
        <button class="calc-btn" onclick="calcInput('7')">7</button>
        <button class="calc-btn" onclick="calcInput('8')">8</button>
        <button class="calc-btn" onclick="calcInput('9')">9</button>
        <button class="calc-btn op" onclick="calcInput('/')">Ã·</button>
        <button class="calc-btn" onclick="calcInput('4')">4</button>
        <button class="calc-btn" onclick="calcInput('5')">5</button>
        <button class="calc-btn" onclick="calcInput('6')">6</button>
        <button class="calc-btn op" onclick="calcInput('*')">Ã—</button>
        <button class="calc-btn" onclick="calcInput('1')">1</button>
        <button class="calc-btn" onclick="calcInput('2')">2</button>
        <button class="calc-btn" onclick="calcInput('3')">3</button>
        <button class="calc-btn op" onclick="calcInput('-')">âˆ’</button>
        <button class="calc-btn" onclick="calcInput('0')">0</button>
        <button class="calc-btn" onclick="calcInput('.')">.</button>
        <button class="calc-btn clr" onclick="calcClear()">C</button>
        <button class="calc-btn op" onclick="calcInput('+')">+</button>
        <button class="calc-btn" onclick="calcBackspace()" style="grid-column:span 1">âŒ«</button>
        <button class="calc-btn eq" onclick="calcEqual()" style="grid-column:span 3">=</button>
      </div>
    </div>

    <!-- è¨˜å¸³ -->
    <div class="card card-sand">
      <div style="font-size:14px;font-weight:700;color:#7c4a0b;margin-bottom:10px"><i class="fa fa-receipt" style="margin-right:6px"></i>è¨˜å¸³</div>
      <div class="expense-item-row">
        <input type="text" id="exp-name" placeholder="å“é …åç¨±ï¼Œä¾‹ï¼šé«˜é›„æ·é‹" style="flex:1"/>
      </div>
      <div class="expense-item-row">
        <input type="date" id="exp-date" style="flex:1;border:1.5px solid #b3edff;border-radius:10px;padding:9px 10px;font-size:14px;background:#f8fcff;font-family:'Noto Sans TC',sans-serif"/>
      </div>
      <div class="expense-item-row">
        <input type="number" id="exp-amount" placeholder="é‡‘é¡" style="flex:2;min-width:80px" oninput="autoCalcPreview()"/>
        <select id="exp-currency" onchange="autoCalcPreview()" style="flex:1;min-width:88px;border:1.5px solid #b3edff;border-radius:10px;padding:9px 6px;font-size:14px;background:#f8fcff;font-family:'Noto Sans TC',sans-serif">
          <option value="TWD">ğŸ’µ å°å¹£</option>
          <option value="JPY">ğŸ’´ æ—¥å¹£</option>
        </select>
      </div>
      <div id="exp-preview" style="font-size:12px;color:#0080a0;text-align:right;margin:-6px 0 8px;min-height:18px"></div>
      <label class="photo-upload-btn" for="photo-file">
        <i class="fa fa-camera"></i> æ‹ç…§ / ä¸Šå‚³æ”¶æ“š
      </label>
      <input type="file" id="photo-file" accept="image/*" capture="environment" style="display:none" onchange="handlePhoto(event)"/>
      <canvas id="compress-canvas"></canvas>
      <div id="photo-preview" style="margin-bottom:10px;display:none">
        <img id="photo-preview-img" style="max-height:80px;border-radius:8px;border:1.5px solid #b3edff"/>
        <button onclick="clearPhoto()" class="btn-danger" style="margin-left:8px;font-size:11px">ç§»é™¤</button>
      </div>
      <button class="btn-primary" style="width:100%;margin-bottom:14px" onclick="addExpense()"><i class="fa fa-plus" style="margin-right:6px"></i>æ–°å¢èŠ±è²»</button>

      <div id="expense-list"></div>

      <div class="expense-total-bar" id="expense-total-bar">
        <div style="display:flex;flex-direction:column;align-items:flex-start;gap:2px">
          <span style="font-size:12px;opacity:.8">ğŸ’´ æ—¥å¹£å°è¨ˆ</span>
          <span id="total-jpy" style="font-size:20px;font-weight:700">Â¥0</span>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:2px">
          <span style="font-size:12px;opacity:.8">ğŸ’µ å°å¹£ç¸½è¨ˆï¼ˆå«æ›ç®—ï¼‰</span>
          <span id="total-twd" style="font-size:20px;font-weight:700">NT$0</span>
        </div>
      </div>
    </div>
  </section>

  <!-- LISTS -->
  <section id="page-lists" class="page">
    <div class="totoro-deco">ğŸ“‹</div>

    <div class="inner-tabs">
      <button class="inner-tab active" onclick="switchListTab('checklist', this)">è¡Œå‰æ¸…å–®</button>
      <button class="inner-tab" onclick="switchListTab('memo', this)">å‚™å¿˜éŒ„</button>
    </div>

    <div id="tab-checklist">
      <div class="card card-ocean" style="margin-bottom:12px">
        <div class="checklist-section-title"><i class="fa fa-briefcase"></i> éš¨èº«è¡Œæ</div>
        <div id="carry-on-list"></div>
      </div>
      <div class="card card-sand">
        <div class="checklist-section-title"><i class="fa fa-suitcase"></i> æ‰˜é‹è¡Œæ</div>
        <div id="checked-bag-list"></div>
      </div>
    </div>

    <div id="tab-memo" style="display:none">
      <div class="card card-ghibli">
        <div style="font-size:13px;font-weight:700;color:#166534;margin-bottom:8px"><i class="fa fa-sticky-note" style="margin-right:6px"></i>å€‹äººå‚™å¿˜éŒ„</div>
        <div style="display:flex;gap:8px;margin-bottom:10px">
          <input type="text" id="memo-input" placeholder="è¼¸å…¥å‚™å¿˜æˆ–è²¼ä¸Šç¶²å€..." style="flex:1;border:1.5px solid #b3edff;border-radius:10px;padding:9px 12px;font-size:14px;outline:none;font-family:'Noto Sans TC',sans-serif"/>
          <button class="btn-primary" onclick="addMemo()"><i class="fa fa-plus"></i></button>
        </div>
        <div id="memo-list"></div>
      </div>
    </div>
  </section>

  <!-- INFO -->
  <section id="page-info" class="page">
    <div class="totoro-deco">â„¹ï¸</div>

    <div class="info-section-title"><i class="fa fa-cloud-sun"></i> å¤©æ°£é å ±</div>
    <a class="info-link" href="https://www.jma.go.jp/bosai/forecast/#area_type=offices&area_code=91000" target="_blank">
      <div class="icon-circle" style="background:#e0f7ff;color:#0080a0"><i class="fa fa-sun"></i></div>
      <div><div style="font-weight:600">æ—¥æœ¬æ°£è±¡å»³ æ²–ç¹©å¤©æ°£</div><div style="font-size:12px;color:#5a7a8a">jma.go.jp å®˜æ–¹å¤©æ°£é å ±</div></div>
    </a>
    <a class="info-link" href="https://www.windy.com/?26.2,127.7,7" target="_blank">
      <div class="icon-circle" style="background:#e0f7ff;color:#00bfea"><i class="fa fa-wind"></i></div>
      <div><div style="font-weight:600">Windy é¢¨å‘é¢¨é€Ÿ</div><div style="font-size:12px;color:#5a7a8a">æ²–ç¹©æµ·ä¸Šæ´»å‹•å®‰å…¨åƒè€ƒ</div></div>
    </a>

    <div class="info-section-title"><i class="fa fa-phone-alt"></i> ç·Šæ€¥è¯çµ¡</div>
    <div class="emergency-card">
      <div style="font-size:13px;color:#7c0000;font-weight:600;margin-bottom:6px">ğŸ‡¯ğŸ‡µ æ—¥æœ¬ç·Šæ€¥é›»è©±ï¼ˆå…è²»ï¼‰</div>
      <div style="display:flex;gap:18px;flex-wrap:wrap">
        <div><div class="emergency-number">110</div><div style="font-size:12px;color:#7c0000">è­¦å¯Ÿ</div></div>
        <div><div class="emergency-number">119</div><div style="font-size:12px;color:#7c0000">æ¶ˆé˜²ãƒ»æ•‘è­·è»Š</div></div>
        <div><div class="emergency-number">118</div><div style="font-size:12px;color:#7c0000">æµ·ä¸Šä¿å®‰å»³</div></div>
      </div>
    </div>
    <a class="info-link" href="https://www.taiwanembassy.org/jp/index.html" target="_blank">
      <div class="icon-circle" style="background:#fff1f2;color:#b91c1c"><i class="fa fa-flag"></i></div>
      <div><div style="font-weight:600">å°ç£é§æ—¥è¾¦äº‹è™•ï¼ˆæ±äº¬ï¼‰</div><div style="font-size:12px;color:#5a7a8a">+81-3-3280-7811 / ç·Šæ€¥ +81-90-4076-4695</div></div>
    </a>
    <a class="info-link" href="https://www.ryukyu-ryokosha.com/inquiry/" target="_blank">
      <div class="icon-circle" style="background:#fff8e1;color:#f5a623"><i class="fa fa-car"></i></div>
      <div><div style="font-weight:600">æ²–ç¸„è¡Œè„šãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼</div><div style="font-size:12px;color:#5a7a8a">é ç´„å°ç¥¿è»Šç«™æ¥é€</div></div>
    </a>

    <div class="info-section-title"><i class="fa fa-exclamation-triangle"></i> å…¥å‡ºå¢ƒæ³¨æ„äº‹é …</div>
    <div class="card" style="padding:10px 14px">
      <div class="notice-item"><i class="fa fa-ban"></i><span><b>é•ç¦å“ï¼š</b>è‚‰è£½å“ï¼ˆå°ç£é¦™è…¸ã€æ»·å‘³ç­‰ï¼‰ä¸å¯æ”œå…¥æ—¥æœ¬ï¼Œé•è€…ç½°æ¬¾æœ€é«˜ 100 è¬æ—¥å¹£ã€‚</span></div>
      <div class="notice-item"><i class="fa fa-ban"></i><span><b>æ¯’å“ï¼š</b>æ—¥æœ¬å°æ¯’å“ç®¡åˆ¶æ¥µåš´ï¼Œå«é•ç¦æˆåˆ†çš„è—¥å“ä¹Ÿä¸å¯å¸¶å…¥ã€‚</span></div>
      <div class="notice-item"><i class="fa fa-leaf"></i><span><b>æ¤ç‰©ï¼š</b>å¸¶å›å°ç£çš„æ°´æœè”¬èœéœ€ç”³å ±ï¼Œéƒ¨åˆ†å“é …ç¦æ­¢è¼¸å…¥ã€‚</span></div>
      <div class="notice-item"><i class="fa fa-money-bill-wave"></i><span><b>ç¾é‡‘ï¼š</b>æ”œå¸¶è¶…é 100 è¬æ—¥å¹£ï¼ˆæˆ–ç­‰å€¼å¤–å¹£ï¼‰å…¥å‡ºå¢ƒéœ€ç”³å ±ã€‚</span></div>
      <div class="notice-item"><i class="fa fa-camera"></i><span><b>ç¥ç¤¾ãƒ»å¯ºå»Ÿï¼š</b>éƒ¨åˆ†ç¥ç¤¾ç¦æ­¢å®¤å…§æ‹ç…§ï¼Œç•™æ„ç¾å ´æŒ‡ç¤ºã€‚</span></div>
      <div class="notice-item"><i class="fa fa-swimming-pool"></i><span><b>å…¥å ´è¦æ±‚ï¼š</b>æº«æ³‰åŠéƒ¨åˆ†è¨­æ–½ç¦æ­¢æœ‰åˆºé’è€…å…¥å ´ã€‚</span></div>
      <div class="notice-item"><i class="fa fa-car"></i><span><b>äº¤é€šï¼š</b>æ—¥æœ¬é å·¦è¡Œé§›ï¼Œè«‹ç‰¹åˆ¥æ³¨æ„æ–¹å‘ã€‚æ²–ç¹©ç§Ÿè»Šæ¨è–¦åŠ æ»¿æ²¹é‚„è»Šï¼ˆç§Ÿè»Šåˆç´„ç¢ºèªï¼‰ã€‚</span></div>
    </div>

    <div class="info-section-title"><i class="fa fa-wifi"></i> å¯¦ç”¨é€£çµ</div>
    <a class="info-link" href="https://www.google.com/maps" target="_blank">
      <div class="icon-circle" style="background:#e0f7ff;color:#0080a0"><i class="fa fa-map"></i></div>
      <div><div style="font-weight:600">Google Maps å°èˆª</div></div>
    </a>
    <a class="info-link" href="https://www.navitime.co.jp/" target="_blank">
      <div class="icon-circle" style="background:#dcfce7;color:#15803d"><i class="fa fa-bus"></i></div>
      <div><div style="font-weight:600">NAVITIME æ—¥æœ¬äº¤é€šæŸ¥è©¢</div></div>
    </a>
    <a class="info-link" href="https://www.currency.me.uk/convert/jpy/twd" target="_blank">
      <div class="icon-circle" style="background:#fff8e1;color:#f5a623"><i class="fa fa-yen-sign"></i></div>
      <div><div style="font-weight:600">JPYâ†’TWD å³æ™‚åŒ¯ç‡</div></div>
    </a>
  </section>

  <!-- DASHBOARD -->
  <section id="page-dash" class="page">
    <div class="totoro-deco">ğŸ±</div>

    <div class="card card-ocean">
      <div style="font-size:14px;font-weight:700;color:#004560;margin-bottom:10px"><i class="fa fa-calendar-day" style="margin-right:6px"></i>ä»Šæ—¥è¡Œç¨‹æé†’</div>
      <div id="dash-today-plan" style="font-size:14px;color:#1a3040;line-height:1.8"></div>
    </div>

    <div class="card card-sand">
      <div style="font-size:14px;font-weight:700;color:#7c4a0b;margin-bottom:12px"><i class="fa fa-chart-bar" style="margin-right:6px"></i>æ¯æ—¥èŠ±è²»çµ±è¨ˆ</div>
      <canvas id="bar-chart" width="100%" height="160" style="display:block;width:100%;height:160px"></canvas>
    </div>

    <div class="card card-ghibli">
      <div style="font-size:14px;font-weight:700;color:#166534;margin-bottom:10px"><i class="fa fa-tasks" style="margin-right:6px"></i>è¡Œå‰æ¸…å–®é€²åº¦</div>
      <div class="progress-bar"><div class="progress-fill" id="checklist-progress"></div></div>
      <div id="checklist-progress-text" style="font-size:13px;color:#5a7a8a;margin-top:6px;text-align:center"></div>
    </div>

    <div class="card" style="background:linear-gradient(135deg,#f0fdf4,#e0f7ff)">
      <div style="font-size:14px;font-weight:700;color:#004560;margin-bottom:8px"><i class="fa fa-plane" style="margin-right:6px"></i>èˆªç­é€ŸæŸ¥</div>
      <div style="font-size:13px;color:#1a3040;line-height:2">
        <div>ğŸ›« <b>å»ç¨‹ IT728</b>ï¼š5/28 16:15 â†’ 18:40</div>
        <div>ğŸ›¬ <b>å›ç¨‹ IT729</b>ï¼š6/1 10:30 â†’ 11:20</div>
        <div>ğŸ¢ <b>èˆªç©ºå…¬å¸</b>ï¼šè™èˆªï¼ˆTiger Air Taiwanï¼‰</div>
      </div>
    </div>

    <div class="card" style="background:linear-gradient(135deg,#f5f3ff,#ede9fe)">
      <div style="font-size:14px;font-weight:700;color:#4c1d95;margin-bottom:12px"><i class="fa fa-database" style="margin-right:6px"></i>è³‡æ–™å‚™ä»½</div>
      <div style="font-size:12px;color:#6d5a8a;margin-bottom:12px;line-height:1.6">åŒ¯å‡ºå¯ä¿ç•™èŠ±è²»ã€å‚™å¿˜éŒ„ã€æ¸…å–®ç­‰æ‰€æœ‰è¨˜éŒ„ï¼›æ›è£ç½®æˆ–æ¸…ç€è¦½å™¨å‰è«‹å…ˆå‚™ä»½ã€‚</div>
      <div style="display:flex;gap:10px">
        <button class="btn-primary" style="flex:1;background:linear-gradient(135deg,#7c3aed,#6d28d9)" onclick="exportData()">
          <i class="fa fa-download" style="margin-right:6px"></i>åŒ¯å‡º JSON
        </button>
        <button class="btn-primary" style="flex:1;background:linear-gradient(135deg,#059669,#047857)" onclick="document.getElementById('import-file').click()">
          <i class="fa fa-upload" style="margin-right:6px"></i>åŒ¯å…¥å‚™ä»½
        </button>
      </div>
      <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(event)">
      <div id="backup-msg" style="font-size:12px;text-align:center;margin-top:8px;min-height:18px"></div>
    </div>
  </section>

  <!-- ===== BOTTOM NAV ===== -->
  <nav class="bottom-nav">
    <button class="active" onclick="switchPage('plan', this)">
      <i class="fa fa-map-marked-alt"></i><span>PLAN</span>
    </button>
    <button onclick="switchPage('guide', this)">
      <i class="fa fa-book-open"></i><span>GUIDE</span>
    </button>
    <button onclick="switchPage('wallet', this)">
      <i class="fa fa-wallet"></i><span>WALLET</span>
    </button>
    <button onclick="switchPage('lists', this)">
      <i class="fa fa-list-check"></i><span>LISTS</span>
    </button>
    <button onclick="switchPage('info', this)">
      <i class="fa fa-circle-info"></i><span>INFO</span>
    </button>
    <button onclick="switchPage('dash', this)">
      <i class="fa fa-gauge-high"></i><span>DASH</span>
    </button>
  </nav>

</div><!-- #app -->

<script>
// =============================================
// DATA
// =============================================
const CARRY_ON = ['è­·ç…§','æ—¥å¹£/å°å¹£','è¡Œå‹•é›»æº','ç›¸æ©Ÿ','éš±çœ¼','ç¶²å¡','æ°´å£º','ç­†','å„é …æ†‘è­‰','è€³æ©Ÿ','å¤–å¥—','å¸½å­','é¢ç´™/æ¿•ç´™å·¾','ä¿¡ç”¨å¡','é§•ç…§/æ—¥æ–‡è­¯æœ¬'];
const CHECKED_BAG = ['æ›æ´—è¡£ç‰©','é‹å­/è¥ªå­','å……é›»å™¨','ç›¥æ´—ç”¨å…·','å…§è¡£è¤²','é›¨å…·','å»¶é•·ç·š','å€‹äººè—¥å“','åŒ–å¦å“/ä¿é¤Šå“','ç”Ÿç†ç”¨å“','é˜²æ›¬ç”¨å“','è¡Œæç§¤','è½‰æ¥é ­','å¡‘è† è¢‹','å°å‰ªåˆ€','è¡£æ¶','çœ¼é¡(ç›’)','å£ç½©','æ£‰èŠ±æ£’','å…¶ä»–'];

const TRIP_DAYS = [
  { date:'2026-05-28', label:'5/28 å››', title:'æŠµé”ãƒ»åœ‹éš›é€š', items:['âœˆ IT728 16:15èµ·é£›','ğŸ› åœ‹éš›é€šæ•£ç­–','ğŸ¨ é‚£éœ¸ä¼‘ä¼Šç‰¹æ¸¡å‡é£¯åº—'] },
  { date:'2026-05-29', label:'5/29 äº”', title:'æµ·å²¸ç·šãƒ»è£½é¹½å·¥å» ', items:['ğŸš— å–è»Šï¼ˆå°ç¥¿è»Šç«™ï¼‰','â›© æ³¢ä¸Šå®®','ğŸŒ‰ æµ·ä¸­é“è·¯','ğŸŒŠ å¤§åŸ”æµ·å²¸','ğŸ§‚ å‘½å¾¡åº­ è£½é¹½å·¥å» ','ğŸ  Airbnbè®€è°·'] },
  { date:'2026-05-30', label:'5/30 å…­', title:'æ´çªŸãƒ»æµ·é‚Šãƒ»åŸè·¡', items:['ğŸ¤¿ é’ä¹‹æ´çªŸ','ğŸ„ æµ·é‚Šæ´»å‹•','ğŸ¯ æ®˜æ³¢å²¬ç‡ˆå¡”','ğŸ­ ç‰çƒæ‘','ğŸ° åº§å–œå‘³åŸ','ğŸ  Airbnbè®€è°·'] },
  { date:'2026-05-31', label:'5/31 æ—¥', title:'ç¾åœ‹æ‘ãƒ»è¿”é‚£éœ¸', items:['ğŸŒ† ç¾åœ‹æ‘','ğŸŒ® åˆé¤ Taco Rice','ğŸš— é‚„è»Šï¼ˆæ²¹åŠ æ»¿ï¼‰','ğŸ¨ é‚£éœ¸ä¼‘ä¼Šç‰¹æ¸¡å‡é£¯åº—'] },
  { date:'2026-06-01', label:'6/1 ä¸€',  title:'è¿”ç¨‹',           items:['âœˆ IT729 10:30èµ·é£› â†’ 11:20æŠµé”'] },
];

// =============================================
// STORAGE HELPERS
// =============================================
const ls = {
  get: (k, def) => { try { return JSON.parse(localStorage.getItem(k)) ?? def; } catch { return def; } },
  set: (k, v) => localStorage.setItem(k, JSON.stringify(v)),
};

// =============================================
// PAGE NAVIGATION
// =============================================
function switchPage(name, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.bottom-nav button').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  btn.classList.add('active');
  if (name === 'dash') renderDash();
}

// =============================================
// CALCULATOR + CURRENCY
// =============================================
let calcExpr = '';
let currentPhoto = null;

function getRate() { return parseFloat(ls.get('jpy_rate', 0.218)); }
function saveRate() {
  const v = parseFloat(document.getElementById('rate-input').value);
  if (v > 0) { ls.set('jpy_rate', v); updateConvert(); alert('åŒ¯ç‡å·²å„²å­˜ï¼'); }
}

window.addEventListener('DOMContentLoaded', () => {
  document.getElementById('rate-input').value = getRate();
});

function calcInput(v) {
  if (calcExpr.length > 20) return;
  calcExpr += v;
  document.getElementById('calc-display').textContent = calcExpr;
  updateConvert();
}
function calcClear() {
  calcExpr = '';
  document.getElementById('calc-display').textContent = '0';
  document.getElementById('calc-converted').textContent = 'â‰ˆ 0 TWD';
}
function calcBackspace() {
  calcExpr = calcExpr.slice(0, -1);
  document.getElementById('calc-display').textContent = calcExpr || '0';
  updateConvert();
}
function calcEqual() {
  try {
    const result = Function('"use strict"; return (' + calcExpr + ')')();
    calcExpr = String(Math.round(result * 100) / 100);
    document.getElementById('calc-display').textContent = calcExpr;
    updateConvert();
  } catch { document.getElementById('calc-display').textContent = 'ERR'; calcExpr = ''; }
}
function updateConvert() {
  try {
    const val = Function('"use strict"; return (' + calcExpr + ')')();
    const twd = Math.round(val * getRate());
    document.getElementById('calc-converted').textContent = `â‰ˆ ${twd.toLocaleString()} TWD`;
  } catch { document.getElementById('calc-converted').textContent = ''; }
}

// =============================================
// EXPENSE (WALLET)
// =============================================
function handlePhoto(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.getElementById('compress-canvas');
      const maxSize = 120;
      let w = img.width, h = img.height;
      if (w > h) { if (w > maxSize) { h = h * maxSize / w; w = maxSize; } }
      else { if (h > maxSize) { w = w * maxSize / h; h = maxSize; } }
      canvas.width = w; canvas.height = h;
      canvas.getContext('2d').drawImage(img, 0, 0, w, h);
      currentPhoto = canvas.toDataURL('image/jpeg', 0.7);
      document.getElementById('photo-preview-img').src = currentPhoto;
      document.getElementById('photo-preview').style.display = 'flex';
      document.getElementById('photo-preview').style.alignItems = 'center';
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}
function clearPhoto() {
  currentPhoto = null;
  document.getElementById('photo-preview').style.display = 'none';
  document.getElementById('photo-file').value = '';
}

function autoCalcPreview() {
  const amount = parseFloat(document.getElementById('exp-amount').value);
  const currency = document.getElementById('exp-currency').value;
  const preview = document.getElementById('exp-preview');
  if (isNaN(amount) || amount < 0) { preview.textContent = ''; return; }
  if (currency === 'JPY') {
    const twd = Math.round(amount * getRate());
    preview.textContent = `â‰ˆ NT$${twd.toLocaleString()} å°å¹£`;
  } else {
    preview.textContent = '';
  }
}

function addExpense() {
  const name = document.getElementById('exp-name').value.trim();
  const amount = parseFloat(document.getElementById('exp-amount').value);
  const currency = document.getElementById('exp-currency').value;
  if (!name || isNaN(amount) || amount < 0) { alert('è«‹å¡«å¯«å“é …èˆ‡é‡‘é¡'); return; }
  const jpy = currency === 'JPY' ? amount : 0;
  const twd = currency === 'TWD' ? amount : Math.round(amount * getRate());
  const list = ls.get('expenses', []);
  const dateVal = document.getElementById('exp-date').value || new Date().toISOString().slice(0, 10);
  list.push({ id: Date.now(), name, amount, currency, jpy, twd, photo: currentPhoto, date: dateVal });
  ls.set('expenses', list);
  document.getElementById('exp-name').value = '';
  document.getElementById('exp-amount').value = '';
  document.getElementById('exp-preview').textContent = '';
  clearPhoto();
  renderExpenses();
  if (document.getElementById('page-dash').classList.contains('active')) renderDash();
}

function deleteExpense(id) {
  if (!confirm('ç¢ºå®šåˆªé™¤æ­¤ç­†ï¼Ÿ')) return;
  ls.set('expenses', ls.get('expenses', []).filter(e => e.id !== id));
  renderExpenses();
  if (document.getElementById('page-dash').classList.contains('active')) renderDash();
}

function expTwd(e) {
  if (e.currency === 'TWD') return e.amount || e.twd || 0;
  if (e.currency === 'JPY') return e.twd != null ? e.twd : Math.round((e.amount || e.jpy || 0) * getRate());
  return e.twd || 0;
}
function expOriginal(e) {
  if (e.currency === 'JPY') return `ğŸ’´ Â¥${(e.amount || e.jpy || 0).toLocaleString()}`;
  if (e.currency === 'TWD') return `ğŸ’µ NT$${(e.amount || e.twd || 0).toLocaleString()}`;
  return `Â¥${(e.jpy||0).toLocaleString()}`;
}

function renderExpenses() {
  const list = ls.get('expenses', []);
  const container = document.getElementById('expense-list');
  if (!list.length) {
    container.innerHTML = '<div style="text-align:center;color:#a0b8c8;font-size:13px;padding:16px 0">å°šç„¡è¨˜å¸³è³‡æ–™</div>';
    document.getElementById('total-jpy').textContent = 'Â¥0';
    document.getElementById('total-twd').textContent = 'NT$0';
    return;
  }
  let totalJpy = 0, totalTwd = 0;
  container.innerHTML = list.map(e => {
    const twd = expTwd(e);
    totalTwd += twd;
    if ((e.currency || 'JPY') === 'JPY') totalJpy += (e.amount || e.jpy || 0);
    const twdLabel = (e.currency === 'TWD') ? '' : `<span style="color:#5a7a8a;font-size:11px"> â‰ˆ NT$${twd.toLocaleString()}</span>`;
    const photoHtml = e.photo
      ? `<img src="${e.photo}" class="expense-thumb" />`
      : `<div class="expense-thumb-placeholder"><i class="fa fa-receipt" style="color:#b3edff"></i></div>`;
    return `<div class="expense-record">
      ${photoHtml}
      <div class="expense-info">
        <div class="expense-name">${e.name}</div>
        <div class="expense-amount">${expOriginal(e)}${twdLabel}</div>
        <div style="font-size:11px;color:#a0b8c8">${e.date}</div>
      </div>
      <button class="btn-danger" onclick="deleteExpense(${e.id})"><i class="fa fa-trash"></i></button>
    </div>`;
  }).join('');
  document.getElementById('total-jpy').textContent = `Â¥${totalJpy.toLocaleString()}`;
  document.getElementById('total-twd').textContent = `NT$${totalTwd.toLocaleString()}`;
}

// =============================================
// CHECKLIST
// =============================================
function buildChecklist(items, storageKey, containerId) {
  const saved = ls.get(storageKey, {});
  const container = document.getElementById(containerId);
  container.innerHTML = items.map((item, i) => {
    const id = `${storageKey}-${i}`;
    const checked = !!saved[i];
    return `<div class="checklist-item ${checked ? 'checked' : ''}" id="ci-${id}">
      <input type="checkbox" id="${id}" ${checked ? 'checked' : ''} onchange="toggleCheck('${storageKey}',${i},'ci-${id}')"/>
      <label for="${id}">${item}</label>
    </div>`;
  }).join('');
}

function toggleCheck(key, idx, rowId) {
  const saved = ls.get(key, {});
  saved[idx] = !saved[idx];
  ls.set(key, saved);
  const row = document.getElementById(rowId);
  if (saved[idx]) row.classList.add('checked'); else row.classList.remove('checked');
  updateChecklistProgress();
}

function updateChecklistProgress() {
  const all = CARRY_ON.length + CHECKED_BAG.length;
  const s1 = ls.get('carry_on', {}), s2 = ls.get('checked_bag', {});
  const done = Object.values(s1).filter(Boolean).length + Object.values(s2).filter(Boolean).length;
  const pct = Math.round(done / all * 100);
  const el = document.getElementById('checklist-progress');
  if (el) el.style.width = pct + '%';
  const txt = document.getElementById('checklist-progress-text');
  if (txt) txt.textContent = `å·²å®Œæˆ ${done} / ${all} é …ï¼ˆ${pct}%ï¼‰`;
}

function switchListTab(tab, btn) {
  document.getElementById('tab-checklist').style.display = tab === 'checklist' ? 'block' : 'none';
  document.getElementById('tab-memo').style.display = tab === 'memo' ? 'block' : 'none';
  document.querySelectorAll('.inner-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

// =============================================
// MEMO
// =============================================
function addMemo() {
  const input = document.getElementById('memo-input');
  const text = input.value.trim();
  if (!text) return;
  const memos = ls.get('memos', []);
  memos.push({ id: Date.now(), text });
  ls.set('memos', memos);
  input.value = '';
  renderMemos();
}

function deleteMemo(id) {
  ls.set('memos', ls.get('memos', []).filter(m => m.id !== id));
  renderMemos();
}

const URL_RE = /(https?:\/\/[^\s]+)/g;
function linkify(text) {
  return text.replace(URL_RE, url => `<a href="${url}" target="_blank">${url}</a>`);
}

function renderMemos() {
  const memos = ls.get('memos', []);
  const container = document.getElementById('memo-list');
  if (!memos.length) {
    container.innerHTML = '<div style="text-align:center;color:#a0b8c8;font-size:13px;padding:12px">å°šç„¡å‚™å¿˜</div>';
    return;
  }
  container.innerHTML = memos.map(m => `
    <div class="memo-item">
      <p>${linkify(m.text)}</p>
      <button class="btn-danger" onclick="deleteMemo(${m.id})" style="flex-shrink:0"><i class="fa fa-times"></i></button>
    </div>`).join('');
}

// =============================================
// DASHBOARD
// =============================================
function renderDash() {
  const expenses = ls.get('expenses', []);
  const rate = getRate();
  const today = new Date().toISOString().slice(0, 10);

  // ä»Šæ—¥èŠ±è²»
  const todayExp = expenses.filter(e => e.date === today);

  // ä»Šæ—¥è¡Œç¨‹
  const dayPlan = TRIP_DAYS.find(d => d.date === today);
  const planEl = document.getElementById('dash-today-plan');
  if (dayPlan) {
    planEl.innerHTML = `<div style="font-weight:700;color:#004560;margin-bottom:6px">${dayPlan.label} ${dayPlan.title}</div>` +
      dayPlan.items.map(i => `<div style="padding:3px 0">${i}</div>`).join('');
  } else {
    const upcoming = TRIP_DAYS.find(d => d.date > today);
    planEl.innerHTML = upcoming
      ? `<div style="color:#5a7a8a">ä»Šå¤©ä¸åœ¨è¡Œç¨‹æœŸé–“ã€‚<br>ä¸‹ä¸€å€‹è¡Œç¨‹ï¼š<b>${upcoming.label} ${upcoming.title}</b></div>`
      : `<div style="color:#5a7a8a">è¡Œç¨‹å·²çµæŸï¼Œæ­¡è¿å›å®¶ï¼ğŸ </div>`;
  }

  // é€²åº¦æ¢
  updateChecklistProgress();

  // Bar Chart
  drawBarChart();
}

function drawBarChart() {
  const canvas = document.getElementById('bar-chart');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  const W = canvas.clientWidth || 320;
  const H = 160;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  ctx.scale(dpr, dpr);

  const expenses = ls.get('expenses', []);
  const perDay = {};
  TRIP_DAYS.forEach(d => perDay[d.label] = 0);
  expenses.forEach(e => {
    const day = TRIP_DAYS.find(d => d.date === e.date);
    if (day) perDay[day.label] = (perDay[day.label] || 0) + expTwd(e);
  });
  const labels = Object.keys(perDay);
  const values = Object.values(perDay);
  const max = Math.max(1, ...values);
  const pad = 36, bw = (W - pad * 2) / labels.length;

  ctx.clearRect(0, 0, W, H);

  // grid lines
  ctx.strokeStyle = '#e0f7ff';
  ctx.lineWidth = 1;
  [0.25, 0.5, 0.75, 1].forEach(r => {
    const y = pad + (H - pad * 2) * (1 - r);
    ctx.beginPath(); ctx.moveTo(pad, y); ctx.lineTo(W - 10, y); ctx.stroke();
  });

  labels.forEach((label, i) => {
    const val = values[i];
    const barH = ((H - pad * 2) * val) / max;
    const x = pad + i * bw + bw * 0.15;
    const y = H - pad - barH;

    // bar gradient
    const grad = ctx.createLinearGradient(0, y, 0, H - pad);
    grad.addColorStop(0, '#00bfea');
    grad.addColorStop(1, '#7ddeff');
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.roundRect(x, y, bw * 0.7, barH, 4);
    ctx.fill();

    // label
    ctx.fillStyle = '#5a7a8a';
    ctx.font = `10px 'Noto Sans TC',sans-serif`;
    ctx.textAlign = 'center';
    ctx.fillText(label.slice(0, 4), x + bw * 0.35, H - pad + 14);

    // value on top
    if (val > 0) {
      ctx.fillStyle = '#004560';
      ctx.font = `bold 10px 'Noto Sans TC',sans-serif`;
      ctx.fillText(`NT$${(val/1000).toFixed(1)}k`, x + bw * 0.35, y - 4);
    }
  });
}

// =============================================
// BACKUP: EXPORT / IMPORT
// =============================================
function exportData() {
  const data = {
    _version: 1,
    _exported: new Date().toISOString(),
    expenses:    ls.get('expenses', []),
    memos:       ls.get('memos', []),
    carry_on:    ls.get('carry_on', {}),
    checked_bag: ls.get('checked_bag', {}),
    jpy_rate:    ls.get('jpy_rate', 0.218),
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `travel-backup-${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  showBackupMsg('âœ… åŒ¯å‡ºå®Œæˆï¼', '#059669');
}

function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const data = JSON.parse(e.target.result);
      if (!data._version) throw new Error('æ ¼å¼éŒ¯èª¤');
      if (data.expenses    !== undefined) ls.set('expenses',    data.expenses);
      if (data.memos       !== undefined) ls.set('memos',       data.memos);
      if (data.carry_on    !== undefined) ls.set('carry_on',    data.carry_on);
      if (data.checked_bag !== undefined) ls.set('checked_bag', data.checked_bag);
      if (data.jpy_rate    !== undefined) ls.set('jpy_rate',    data.jpy_rate);
      renderExpenses();
      renderMemos();
      buildChecklist(CARRY_ON,    'carry_on',    'carry-on-list');
      buildChecklist(CHECKED_BAG, 'checked_bag', 'checked-bag-list');
      document.getElementById('rate-input').value = getRate();
      renderDash();
      showBackupMsg('âœ… åŒ¯å…¥æˆåŠŸï¼è³‡æ–™å·²é‚„åŸã€‚', '#059669');
    } catch {
      showBackupMsg('âŒ æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼ŒåŒ¯å…¥å¤±æ•—', '#dc2626');
    }
    event.target.value = '';
  };
  reader.readAsText(file);
}

function showBackupMsg(msg, color) {
  const el = document.getElementById('backup-msg');
  if (!el) return;
  el.textContent = msg;
  el.style.color = color;
  setTimeout(() => { el.textContent = ''; }, 4000);
}

// =============================================
// INIT
// =============================================
document.addEventListener('DOMContentLoaded', () => {
  buildChecklist(CARRY_ON, 'carry_on', 'carry-on-list');
  buildChecklist(CHECKED_BAG, 'checked_bag', 'checked-bag-list');
  renderExpenses();
  renderMemos();
  document.getElementById('rate-input').value = getRate();
  document.getElementById('exp-date').value = new Date().toISOString().slice(0, 10);
});
</script>
</body>
</html>
